<html>
  <head>
    <script src="./axios.min.js"></script>
    <link href="./style.css" type="text/css" rel="stylesheet" />
    <link href="./favicon.ico" rel="shortcut icon">
  </head>
  <body>
    <title>留言板</title>
    <div class="bar">
      <button type="button" onclick="getComments()">🔄</button>
      <input type="text" name="name" placeholder="name" id="name"/>
      <input type="text" name="content" placeholder="say..." id="content"/>
      <button type="button" onclick="addComment()">send</button>
    </div>
  <table>
    <thead>
      <th>id</th>
      <th>name</th>
      <th>content</th>
      <th>create_at</th>
    </thead>
    <tbody id="loader">
    </tbody>
  </table>
  <script>
    const API_URL = 'https://demo.outshaker.tw/api/comments'
    const loader = document.querySelector('#loader')
    const getComments = () => {
      axios.get(API_URL)
        .then(function ({data:list}) {
          loader.innerHTML = ''
          list.forEach((e) => {
            const tr = document.createElement('tr')
            tr.innerHTML = `<td>${e.id}</td><td>${e.name}</td><td>${e.content}</td><td>${e.created_at}</td>`
            loader.insertBefore(tr, loader.firstChild);
            // loader.appendChild(tr)
          })
        })
          .catch(function (error) {
            console.log(error);
        })
          // .finally(function () {
        // });
    }
    const addComment = (e) => {
      const eName = document.querySelector('#name')
      const eContent = document.querySelector('#content')
      if (!eName.value || !eContent.value) {
        e.stopPropagation()
        return false
      }
      console.log(eName.value, eContent.value)
      axios.post(API_URL, {name: eName.value, content: eContent.value})
        .then(function ({data:item}) {
          const tr = document.createElement('tr')
          tr.innerHTML = `<td>${item.id}</td><td>${item.name}</td><td>${item.content}</td><td>${item.created_at}</td>`
          loader.insertBefore(tr, loader.firstChild);
        })
        .catch(function (error) {
          console.log(error);
        })
        // .finally(function () {
        // });
    }
    window.addEventListener('DOMContentLoaded', getComments);
  </script>
  </body>
</html>

